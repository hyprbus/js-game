!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);const s=t=>async i=>{try{const e=await Promise.all(i.map(i=>t(i)));let s={};return e.forEach(t=>s[Object.keys(t)[0]]=t[Object.keys(t)[0]]),s}catch(t){console.error("error loading image assets")}},h=s(t=>new Promise((i,e)=>{const s=new Image,h=Object.keys(t)[0];s.addEventListener("load",()=>i({[h]:s})),s.addEventListener("error",e),s.src=t[h]})),o=s(t=>new Promise((i,e)=>{const s=new Audio,h=Object.keys(t)[0];s.addEventListener("loadeddata",()=>i({[h]:s})),s.addEventListener("error",e),s.src=t[h]}));class a{constructor(t){this.gameWidth=t.gameWidth,this.image=t.assets.images.rocket,this.width=16,this.height=16,this.maxSpeed=4,this.speed=0,this.position={x:t.gameWidth/2-this.width/2,y:t.gameHeight-this.height-16},this.delete=!1}moveLeft(){this.speed=-this.maxSpeed}moveRight(){this.speed=this.maxSpeed}stop(){this.speed=0}draw(t){this.isExploding||t.drawImage(this.image,this.position.x,this.position.y,this.width,this.height)}update(t){this.position.x+=this.speed,this.position.x<0&&(this.position.x=0),this.position.x+this.width>this.gameWidth&&(this.position.x=this.gameWidth-this.width)}}class n{constructor(t,i){this.image=i,this.gameWidth=t.gameWidth,this.gameHeight=t.gameHeight,this.game=t,this.size={x:this.gameWidth,y:this.gameHeight},this.reset()}reset(){this.position={x:0,y:0},this.speed={x:0,y:2}}draw(t){t.drawImage(this.image,this.position.x,this.position.y,this.size.x,this.size.y),t.drawImage(this.image,this.position.x,this.position.y-this.gameHeight,this.size.x,this.size.y)}update(t){this.position.x+=this.speed.x,this.position.y+=this.speed.y,this.position.y>=this.gameHeight&&(this.position.y=0)}}class r{constructor(t,i,e){document.addEventListener("keydown",s=>{switch(s.keyCode){case 37:t.moveLeft();break;case 39:t.moveRight();break;case 32:i.fire();break;case 27:e.togglePause();break;case 13:e.startGame()}}),document.addEventListener("keyup",i=>{switch(i.keyCode){case 37:t.speed<0&&t.stop();break;case 39:t.speed>0&&t.stop()}})}}const l={RUNNING:1,MENU:2,GAMEOVER:3,WON:4},g=1,d=5;class c{constructor(t){this.image=t.assets.images.laser,this.sound=t.assets.sounds.laser,this.gameWidth=t.gameWidth,this.gameHeight=t.gameHeight,this.game=t,this.width=4,this.height=16,this.position={x:400,y:550},this.isShooting=!1,this.reset(),this.speed={x:0,y:-4},this.velocity}reset(){this.position={x:400,y:550},this.isShooting=!1}fire(){this.isShooting||this.game.gamestate!=l.RUNNING||this.game.rocket.isExploding||(this.position.x=this.game.rocket.position.x+this.game.rocket.width/2-this.width/2,this.position.y=this.game.rocket.position.y-this.height,this.sound.pause(),this.sound.currentTime=0,this.sound.play(),this.isShooting=!0)}draw(t){this.isShooting&&t.drawImage(this.image,this.position.x,this.position.y,this.width,this.height)}update(t){this.isShooting&&(this.position.y+=this.speed.y,this.position.y<0&&this.reset())}}function m(t,i){if(t.delete||i.delete)return;let e=t.position.y,s=t.position.x,h=t.position.x+t.width,o=t.position.y+t.height,a=i.position.y,n=i.position.x,r=i.position.x+i.width,l=i.position.y+i.height;return o>a&&e<l&&h>n&&s<r}class p{constructor({ID:t,alienType:i,game:e,position:s,imageKey:h,width:o,height:a,initVector:n,hitScore:r,spriteAnimationOrder:l,movementAlgorithm:g}){this.image=e.assets.images[h],this.sound=e.assets.sounds.explosion,this.gameWidth=e.gameWidth,this.gameHeight=e.gameHeight,this.game=e,this.width=o,this.height=a,this.position={...s},this.speed=e.gameSpeed,this.vector={...n},this.delete=!1,this.hitScore=r,this.sprites=l,this.spriteIndex=0,this.animationRate=10,this.animationRateCounter=0,this.movementAlgorithm=g,this.ID=t,this.alienType=i}draw(t){t.drawImage(this.image,this.sprites[this.spriteIndex]*this.width,0,this.width,this.height,this.position.x,this.position.y,this.width,this.height)}update(t){m(this.game.rocket,this)&&this.game.rocketHitByAlien(),this.game.laser.isShooting&&m(this.game.laser,this)&&(this.sound.pause(),this.sound.currentTime=0,this.sound.volume=.45,this.sound.play(),this.delete=!0,this.game.score=this.game.score+this.hitScore,this.game.laser.reset()),this.position.x+=this.vector.x,this.position.y+=this.vector.y,this.position.y>this.gameHeight&&(this.position.y=-20),this.movementAlgorithm(this),this.animationRateCounter++,this.animationRateCounter===this.animationRate&&(this.animationRateCounter=0,this.spriteIndex++,this.spriteIndex===this.sprites.length&&(this.spriteIndex=0))}}function u(t){t.position.x>=t.gameWidth-t.width&&(t.vector.x=-t.speed,t.vector.y=Math.round(Math.random())*t.speed),t.position.x<=0&&(t.vector.x=t.speed,t.vector.y=Math.round(Math.random())*t.speed),(t.position.y>t.gameHeight-50||t.position.y<0)&&(t.vector.y=t.speed)}const y=({angle:t,steps:i,swingWidth:e})=>s=>{s.vector.y=Math.abs(s.speed),(s.position.x>=s.gameWidth-s.width||s.position.x<=0)&&(i=-i,s.speed=-s.speed);const h=t;t=x(t,i),s.vector.x=e*(Math.cos(h)-Math.cos(t))+s.speed},x=(t,i)=>t<2*Math.PI?t+2*Math.PI/i:t-2*Math.PI,f=[[[1,0,1,0,1]],[[0,0,2],[0],[1,1,1,1,1]],[[1,0,1,0,1],[1,1,1,1,1]],[[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]],[[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],[[2,0,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1]],[[0,2,0,0,2,0,0,2],[0],[0,0,2,0,0,2]]];class w{constructor(t,i,e,s=20,h="255, 255, 255"){this.gameWidth=t.gameWidth,this.gameHeight=t.gameHeight,this.game=t,this.position={x:i.x,y:i.y},this.speed=20*Math.random(),this.vector={x:this.speed*(Math.random()-.5),y:this.speed*(Math.random()-.5)},this.opacity=1,this.lifeLength=s,this.radius=e*Math.random(),this.color=h,this.delete=!1}draw(t){var i,e;t.beginPath(),t.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI,!1),t.fillStyle=(i=this.color,e=this.opacity,`rgba(${i}, ${e})`),t.fill()}update(t){this.position.x+=this.vector.x,this.position.y+=this.vector.y,this.opacity=this.opacity-1/this.lifeLength,this.opacity<=0&&(this.opacity=0,this.delete=!0)}}class v{constructor(t,i,e=10,s=20,h=8,o="255, 255, 255"){this.gameWidth=t.gameWidth,this.gameHeight=t.gameHeight,this.game=t,this.particles=[],this.createParticles(t,i,e,s,h,o),this.delete=!1}createParticles(t,i,e,s,h,o){for(let t=0;t<h;t++)this.particles.push(new w(this.game,i,e,s,o))}draw(t){this.particles.forEach(i=>i.draw(t))}update(t){this.particles=this.particles.filter(t=>!t.delete),0===this.particles.length&&(this.delete=!0),this.particles.forEach(i=>i.update(t))}}class E{constructor(t,i,e){this.gameWidth=t,this.gameHeight=i,this.gamestate=l.MENU,this.gameSpeed=2,this.assets=e,this.rocket=new a(this),this.laser=new c(this),this.background=new n(this,e.images.background),this.gameObjects=[],this.lives=3,this.aliens=[],this.alienExplosions=[],this.rocketExplosion=null,this.level=0,this.score=0,this.music=this.assets.sounds.soundtrack,this.musicIsPlaying=!1,new r(this.rocket,this.laser,this)}reset(){this.level=0,this.lives=3,this.score=0,this.gamestate=l.MENU}startLevel(){this.alienExplosions=[],this.rocketExplosion=null,this.rocket.delete=!1,this.aliens=function(t,i){let e=[];return i.forEach((i,s)=>{i.forEach((i,h)=>{let o={x:16+32*h,y:16+32*s};const a=10*(s+1)+h;1===i&&e.push(new p({ID:a,alienType:g,game:t,position:o,imageKey:"alien",width:16,height:16,initVector:{x:t.gameSpeed,y:0},hitScore:100,spriteAnimationOrder:[0,1],movementAlgorithm:u})),2===i&&e.push(new p({ID:a,alienType:d,game:t,position:o,imageKey:"alienBoss",width:32,height:32,initVector:{x:t.gameSpeed,y:0},hitScore:500,spriteAnimationOrder:[0,1],movementAlgorithm:y({angle:0,steps:120,swingWidth:80})}))})}),e}(this,f[this.level]),this.gameObjects=[this.background,this.rocket,this.laser],this.gamestate=l.RUNNING}startGame(){this.gamestate!==l.RUNNING&&(this.reset(),this.startLevel())}rocketHitByAlien(){const t=this.assets.sounds.death;t.pause(),t.currentTime=0,t.volume=.4,t.play(),this.lives--,this.laser.reset(),this.rocket.delete=!0,this.rocketExplosion=new v(this,this.rocket.position,8,80,100,"0, 255, 255"),this.gameObjects.push(this.rocketExplosion),this.aliens.forEach(t=>{t.position.y=-300})}update(t){0===this.lives&&(this.gamestate=l.GAMEOVER),this.gamestate!==l.PAUSED&&this.gamestate!==l.MENU&&(!1===this.musicIsPlaying&&(this.musicIsPlaying=!0,this.music.loop=!0,this.music.volume=1,this.music.play()),0===this.aliens.length&&0===this.alienExplosions.length&&(this.level===f.length-1?this.gamestate=l.WON:(this.level++,this.startLevel())),[...this.gameObjects,...this.aliens,...this.alienExplosions].forEach(i=>i.update(t)),this.alienExplosions=this.alienExplosions.filter(t=>!t.delete),this.gameObjects=this.gameObjects.filter(t=>!t.delete),this.rocketExplosion&&this.rocketExplosion.delete&&this.gamestate!==l.GAMEOVER&&(this.rocketExplosion=null,this.rocket.delete=!1,this.gameObjects.push(this.rocket)),this.aliens.forEach(t=>{t.delete&&this.alienExplosions.push(new v(this,t.position,8,30,24,"255, 255, 0"))}),this.aliens=this.aliens.filter(t=>!t.delete))}draw(t){[...this.gameObjects,...this.aliens,...this.alienExplosions].forEach(i=>i.draw(t)),this.gamestate!==l.MENU&&(t.font="12px Courier",t.fillStyle="yellow",t.textAlign="left",t.fillText(`Lives: ${this.lives} Score: ${this.score} Level: ${this.level}`,8,16)),this.gamestate===l.PAUSED&&(t.rect(0,0,this.gameWidth,this.gameHeight),t.fillStyle="rgba(0,0,0,0.5)",t.fill(),t.font="20px Arial",t.fillStyle="white",t.textAlign="center",t.fillText("Paused",this.gameWidth/2,this.gameHeight/2)),this.gamestate===l.MENU&&(t.rect(0,0,this.gameWidth,this.gameHeight),t.fillStyle="rgba(0,0,0,1)",t.fill(),t.font="20px Arial",t.fillStyle="white",t.textAlign="center",t.fillText("Press ENTER To Start",this.gameWidth/2,this.gameHeight/2)),this.gamestate===l.GAMEOVER&&(t.font="20px Arial",t.fillStyle="white",t.textAlign="center",t.fillText("GAME OVER",this.gameWidth/2,this.gameHeight/2),t.fillText("Press ENTER to play again",this.gameWidth/2,this.gameHeight/2+40)),this.gamestate===l.WON&&(t.font="20px Courier",t.fillStyle="white",t.textAlign="center",t.fillText("You won! Earth is saved.",this.gameWidth/2,this.gameHeight/2))}togglePause(){this.gamestate!==l.RUNNING&&this.gamestate!==l.PAUSED||(this.gamestate===l.PAUSED?this.gamestate=l.RUNNING:(this.gamestate=l.PAUSED,this.musicIsPlaying=!1,this.music.pause()))}}const k=[{background:"images/bk.png"},{rocket:"images/rocket.png"},{laser:"images/laser.png"},{alien:"images/alien.png"},{alienBoss:"images/alien-boss.png"}],b=[{soundtrack:"audio/alien-attack-soundtrack.mp3"},{laser:"audio/laser.mp3"},{explosion:"audio/explosion.mp3"},{death:"audio/death.mp3"}],S=((t,i,e)=>{const s=document.createElement("canvas");s.setAttribute("id",t);const h=s.getContext("2d");return s.width=i,s.height=e,document.body.appendChild(s),h})("ctx",400,300);let A=0;(async()=>{try{const t=await h(k),i=await o(b);let e=new E(400,300,{images:t,sounds:i});const s=t=>i=>{let h=i-A;A=i,t.clearRect(0,0,400,300),e.update(h),e.draw(t),requestAnimationFrame(s(t))};requestAnimationFrame(s(S))}catch(t){console.error("Could not initialize and run game:",t)}})()}]);